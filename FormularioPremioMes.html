<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vota√ß√£o - Melhor Funcion√°rio do M√™s</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c5aa0 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .form-content {
            padding: 40px;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }

        select, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        select:focus, textarea:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .employee-card {
            background: #f8f9ff;
            border: 2px solid #e1e8ed;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .employee-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .employee-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c5aa0;
            margin-bottom: 20px;
            text-align: center;
        }

        .criteria-grid {
            display: grid;
            gap: 20px;
        }

        .criteria-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e1e8ed;
        }

        .criteria-label {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .star-rating {
            display: flex;
            gap: 5px;
        }

        .star {
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .star:hover, .star.active {
            color: #ffd700;
            transform: scale(1.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .progress {
            background: #e1e8ed;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .summary {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .summary h3 {
            color: #2c5aa0;
            margin-bottom: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e1e8ed;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .success {
            background: #d1edff;
            border-color: #74b9ff;
            color: #0984e3;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .form-content {
                padding: 20px;
            }
            
            .criteria-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <scipt>
    <div class="container">
        <div class="header">
            <h1>üèÜ Vota√ß√£o Mensal</h1>
            <p>Melhor Funcion√°rio do M√™s</p>
        </div>

        <div class="form-content">
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <!-- Etapa 1: Sele√ß√£o da Equipe -->
            <div class="step active" id="step1">
                <h2 style="margin-bottom: 30px; color: #2c5aa0;">Selecione sua Equipe</h2>
                <div class="form-group">
                    <label for="teamSelect">Qual √© a sua equipe?</label>
                    <select id="teamSelect" required>
                        <option value="">Selecione sua equipe...</option>
                        <option value="GDPRO">GDPRO</option>
                        <option value="GDGDI">GDGDI</option>
                        <option value="GDGEP">GDGEP</option>
                        <option value="GDGPE">GDGPE</option>
                        <option value="GDGRE">GDGRE</option>
                        <option value="GDGDG">GDGDG</option>
                    </select>
                </div>
                <button class="btn" onclick="nextStep()">Pr√≥ximo</button>
            </div>

            <!-- Etapa 2: Avalia√ß√µes -->
            <div class="step" id="step2">
                <h2 style="margin-bottom: 30px; color: #2c5aa0;">Avalie seus Colegas de Equipe</h2>
                <div id="evaluationContainer"></div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="previousStep()">Voltar</button>
                    <button class="btn" onclick="nextStep()">Pr√≥ximo</button>
                </div>
            </div>

            <!-- Etapa 3: Observa√ß√µes -->
            <div class="step" id="step3">
                <h2 style="margin-bottom: 30px; color: #2c5aa0;">Observa√ß√µes e Justificativas</h2>
                <div class="form-group">
                    <label for="observations">Observa√ß√µes gerais sobre as avalia√ß√µes (opcional):</label>
                    <textarea id="observations" rows="6" placeholder="Compartilhe suas observa√ß√µes sobre o desempenho dos colegas avaliados..."></textarea>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="previousStep()">Voltar</button>
                    <button class="btn" onclick="nextStep()">Revisar</button>
                </div>
            </div>

            <!-- Etapa 4: Resumo -->
            <div class="step" id="step4">
                <h2 style="margin-bottom: 30px; color: #2c5aa0;">Resumo da Avalia√ß√£o</h2>
                <div id="summaryContainer"></div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="previousStep()">Voltar</button>
                    <button class="btn" onclick="submitEvaluation()">Finalizar Avalia√ß√£o</button>
                </div>
            </div>

            <!-- Etapa 5: Confirma√ß√£o -->
            <div class="step" id="step5">
                <div class="alert success">
                    <h3>‚úÖ Avalia√ß√£o Enviada com Sucesso!</h3>
                    <p>Sua avalia√ß√£o foi registrada. Clique no bot√£o abaixo para baixar os dados em CSV.</p>
                </div>
                <div style="text-align: center;">
                    <button class="btn" onclick="downloadCSV()">üì• Baixar Dados (CSV)</button>
                    <button class="btn btn-secondary" onclick="resetForm()">Nova Avalia√ß√£o</button>
                </div>
            </div>
        </div>
    </div>

const employees = {
    // ... (Manter sua lista de funcion√°rios original)
    "GDPRO": [
        "Andre Luis Andrade Lago",
        "Erick Goldner Baptista Silva", 
        "Gersumino Madela Neto",
        "Andre Luiz Freitas Lopes",
        "Flavio de Melo Martins Pinheiro",
        "Iata Anderson Dourado Araujo",
        "Idarlan Martins Machado",
        "Jose Bernardo Wernik Mizratti",
        "Sergio de Menezes Carvalho"
    ],
    "GDGDI": [
        "Dulcimara Roberta Ferreira Delfes",
        "Cristiane Lustosa Guimaraes Franca",
        "Gabriel Oliveira Faria",
        "Aguinaldo Vieira de Abreu",
        "Carlos Gustavo Lopes Lima",
        "Gilda Nogueira Silva Pestana",
        "Glaucio de Souza Landim"
    ],
    "GDGEP": [
        "Lindomar Guimaraes de Oliveira Junior",
        "Danielle Eulalia Lelis dos Santos",
        "Greicy Cristina do Prado Rigo",
        "Flavia de Sousa Silvestre",
        "Alessandro Luiz Mamus",
        "Guilherme Soares de Carvalho",
        "Henrique Garcia de Souza",
        "Joao Henrique Siqueira Engel",
        "Jose Celio Reis Soares",
        "Wellison Angelim Reis"
    ],
    "GDGPE": [
        "Lucy Mitiko Tashiro",
        "Alexandre Rodrigues Andrade",
        "Marcia Missias Gomes",
        "Maurizete Carvalho Correa",
        "Andrei Pimenta Sibin",
        "Italo Petronio Fernandes Barbosa",
        "Jorge Leandro Brasil de Sena"
    ],
    "GDGRE": [
        "Luis Gustavo Loyola dos Santos Filho",
        "Carlos Bruno Gomes Cahu",
        "Renata Correa Sousa",
        "Carmen Deia de Lima Rodrigues",
        "Cristina Kenia Fiuza Silva",
        "Frederico Gil Moreira Santiago",
        "Geison Souza de Salles",
        "Jos√© Ricardo Barquinha Ribeiro",
        "Paulina Maria de Medeiros do Amaral",
        "Sandro Magalhaes Souza",
        "Sheyla Aparecida Cavalcanti",
        "Soraia Martins Lima"
    ],
    "GDGDG": [
        "Marilei Martins de Melo",
        "Helder Rocha dos Santos",
        "Luiz Tom√© Vilhena Dantas Neto",
        "Anderson J√∫nio Leal Moraes",
        "Emerson Jeronimo Oliveira da Silva",
        "Petr√¥nio da Costa Pereira",
        "Tiberio Cesar Vilar Vieira",
        "Yara Athayde Athayde"
    ]
};

const criteria = [
    "Cumprimento de metas",
    "Proatividade e iniciativa", 
    "Esp√≠rito de equipe e colabora√ß√£o",
    "Resolu√ß√£o de problemas",
    "Criatividade e inova√ß√£o",
    "Destaque em atendimento ao cliente",
    "Supera√ß√£o e crescimento profissional"
];

let currentStep = 1; // 1: Equipe, 2: Avalia√ß√µes, 3: Observa√ß√µes, 4: Resumo, 5: Confirma√ß√£o
let selectedTeam = '';
let evaluations = {};
let evaluationData = [];
let currentEmployeeIndex = 0; // Novo: Rastreia qual funcion√°rio est√° sendo avaliado

// Sua URL do Apps Script
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbz9u-zRTaAKEXuhumFcjDmS1WsUfwoss38_1r4lGMkrJ4ZI_h-pd3tmBLKVmm9dtQWsnA/exec'; 

// --- Fun√ß√µes de Navega√ß√£o e Progresso ---

function updateProgress() {
    let progress = 0;
    const numEmployees = employees[selectedTeam] ? employees[selectedTeam].length : 0;
    
    if (currentStep === 1) {
        progress = 0;
    } else if (currentStep === 2) {
        // O progresso dentro do Step 2 √© a avalia√ß√£o de cada funcion√°rio
        progress = (currentEmployeeIndex / numEmployees) * 80; // 80% do total
    } else if (currentStep === 3) {
        progress = 85;
    } else if (currentStep === 4) {
        progress = 90;
    } else if (currentStep === 5) {
        progress = 100;
    }

    document.getElementById('progressBar').style.width = progress + '%';
}

function nextStep() {
    if (currentStep === 1) {
        // Valida√ß√£o da Equipe
        selectedTeam = document.getElementById('teamSelect').value;
        if (selectedTeam === '') {
            alert('Por favor, selecione sua equipe.');
            return;
        }
        generateEvaluationForms();
        currentStep++;
        showStep();
        
    } else if (currentStep === 2) {
        // Valida√ß√£o do Funcion√°rio Atual
        if (!validateCurrentEmployeeEvaluation()) {
             alert('Voc√™ precisa avaliar pelo menos um crit√©rio para este funcion√°rio.');
             return;
        }

        const teamEmployees = employees[selectedTeam];
        
        // Se ainda houver funcion√°rios para avaliar, avance para o pr√≥ximo
        if (currentEmployeeIndex < teamEmployees.length - 1) {
            currentEmployeeIndex++;
            showStep(); // Apenas atualiza a aba dentro do step 2
        } else {
            // Todos avaliados, avance para a Observa√ß√£o
            currentStep++;
            showStep();
        }
    } else if (currentStep === 3) {
        // Avan√ßa para o Resumo
        generateSummary();
        currentStep++;
        showStep();
    } else if (currentStep === 4) {
        // √öltima etapa antes da submiss√£o
        submitEvaluation();
    }
}

function previousStep() {
    if (currentStep === 2) {
        // Se estiver avaliando, volta para o funcion√°rio anterior ou para a sele√ß√£o de equipe
        if (currentEmployeeIndex > 0) {
            currentEmployeeIndex--;
            showStep();
        } else {
            currentStep--;
            showStep();
        }
    } else if (currentStep > 1 && currentStep < 5) {
        currentStep--;
        showStep();
    }
}

function showStep() {
    document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
    document.getElementById('step' + currentStep).classList.add('active');
    
    if (currentStep === 2) {
        // Mostra apenas o card do funcion√°rio atual
        document.querySelectorAll('.employee-card').forEach((card, index) => {
            card.style.display = (index === currentEmployeeIndex) ? 'block' : 'none';
        });
        
        // Atualiza os bot√µes de navega√ß√£o no Step 2
        const container = document.getElementById('evaluationContainer');
        const teamEmployees = employees[selectedTeam];
        let buttons = container.querySelector('#step2-buttons');
        if (!buttons) {
             buttons = document.createElement('div');
             buttons.id = 'step2-buttons';
             buttons.style.cssText = 'text-align: center; margin-top: 30px;';
             container.appendChild(buttons);
        }
        
        const previousBtn = `<button class="btn btn-secondary" onclick="previousStep()">${currentEmployeeIndex === 0 ? 'Voltar (Equipe)' : 'Voltar'}</button>`;
        const nextBtn = `<button class="btn" onclick="nextStep()">${currentEmployeeIndex === teamEmployees.length - 1 ? 'Avan√ßar (Observ.)' : 'Pr√≥ximo'}</button>`;
        buttons.innerHTML = previousBtn + nextBtn;
        
    } else {
         // Oculta os bot√µes espec√≠ficos do Step 2 se estiver em outra etapa
         const buttons = document.getElementById('step2-buttons');
         if(buttons) buttons.style.display = 'none';
    }

    updateProgress();
}

// --- Fun√ß√µes de Avalia√ß√£o e Valida√ß√£o ---

function validateCurrentEmployeeEvaluation() {
    const employee = employees[selectedTeam][currentEmployeeIndex];
    if (!evaluations[employee]) {
        return false; // N√£o avaliado
    }
    
    // Verifica se pelo menos um crit√©rio tem nota > 0
    return criteria.some(criterion => evaluations[employee][criterion] > 0);
}

function generateEvaluationForms() {
    const container = document.getElementById('evaluationContainer');
    const teamEmployees = employees[selectedTeam];
    
    container.innerHTML = '';
    currentEmployeeIndex = 0; // Resetar para o primeiro funcion√°rio
    
    teamEmployees.forEach((employee, empIndex) => {
        const employeeCard = document.createElement('div');
        employeeCard.className = 'employee-card';
        employeeCard.style.display = (empIndex === currentEmployeeIndex) ? 'block' : 'none';
        
        let criteriaHTML = '';
        criteria.forEach(criterion => {
            criteriaHTML += `
                <div class="criteria-item">
                    <div class="criteria-label">${criterion}</div>
                    <div class="star-rating" data-employee="${employee}" data-criterion="${criterion}">
                        ${[1,2,3,4,5].map(i => `<span class="star" data-rating="${i}">‚òÖ</span>`).join('')}
                    </div>
                </div>
            `;
        });
        
        employeeCard.innerHTML = `
            <div class="employee-name">${employee}</div>
            <p style="text-align: center; margin-bottom: 20px;">Voc√™ precisa avaliar pelo menos um item para este colega.</p>
            <div class="criteria-grid">
                ${criteriaHTML}
            </div>
        `;
        
        container.appendChild(employeeCard);
    });
    
    // Adicionar event listeners para as estrelas
    document.querySelectorAll('.star-rating').forEach(rating => {
        const stars = rating.querySelectorAll('.star');
        const employee = rating.getAttribute('data-employee');
        const criterion = rating.getAttribute('data-criterion');
        
        stars.forEach(star => {
            star.addEventListener('click', () => {
                const rating_value = parseInt(star.getAttribute('data-rating'));
                
                if (!evaluations[employee]) {
                    evaluations[employee] = {};
                }
                
                // Toggle: Se clicar na nota atual, desmarca (nota 0/branco)
                const currentRating = evaluations[employee][criterion] || 0;
                let finalRating = rating_value;
                if (rating_value === currentRating) {
                    finalRating = 0; // Desmarca
                }
                
                evaluations[employee][criterion] = finalRating;
                
                // Atualizar visual das estrelas
                stars.forEach((s, index) => {
                    s.classList.toggle('active', index < finalRating);
                });
            });
            
            star.addEventListener('mouseenter', () => {
                const hoverRating = parseInt(star.getAttribute('data-rating'));
                stars.forEach((s, index) => {
                    s.style.color = index < hoverRating ? '#ffd700' : '#ddd';
                });
            });
            
            star.addEventListener('mouseleave', () => {
                const currentRating = evaluations[employee] && evaluations[employee][criterion] || 0;
                stars.forEach((s, index) => {
                    s.style.color = index < currentRating ? '#ffd700' : '#ddd';
                });
            });
        });

        // Aplicar notas salvas (se existirem) ao carregar
        const initialRating = evaluations[employee] && evaluations[employee][criterion] || 0;
        stars.forEach((s, index) => {
            s.classList.toggle('active', index < initialRating);
        });
    });
}

function generateSummary() {
    const container = document.getElementById('summaryContainer');
    const teamEmployees = employees[selectedTeam];
    
    let summaryHTML = `<div class="summary">
        <h3>Equipe: ${selectedTeam}</h3>
    </div>`;
    
    teamEmployees.forEach(employee => {
        if (evaluations[employee] && validateCurrentEmployeeEvaluation(employee)) {
            let totalScore = 0;
            let criteriaCounted = 0;
            let criteriaHTML = '';
            
            criteria.forEach(criterion => {
                const score = evaluations[employee][criterion] || 0;
                const scoreDisplay = score > 0 ? ('‚òÖ'.repeat(score) + '‚òÜ'.repeat(5-score)) : 'N√£o Avaliado';
                
                criteriaHTML += `
                    <div class="summary-item">
                        <span>${criterion}</span>
                        <span>${scoreDisplay}</span>
                    </div>
                `;
                
                if (score > 0) {
                    totalScore += score;
                    criteriaCounted++;
                }
            });
            
            const averageScore = criteriaCounted > 0 ? (totalScore / criteriaCounted).toFixed(1) : "N/A";
            
            summaryHTML += `
                <div class="summary">
                    <h3>${employee} - M√©dia: ${averageScore}/5.0 (${criteriaCounted} itens avaliados)</h3>
                    ${criteriaHTML}
                </div>
            `;
        } else {
             summaryHTML += `
                <div class="summary alert">
                    <h3>${employee}</h3>
                    <p>‚ö†Ô∏è N√£o avaliado ou avalia√ß√£o incompleta (Zero itens avaliados).</p>
                </div>
            `;
        }
    });
    
    const observations = document.getElementById('observations').value;
    if (observations.trim()) {
        summaryHTML += `
            <div class="summary">
                <h3>Observa√ß√µes</h3>
                <p>${observations}</p>
            </div>
        `;
    }
    
    container.innerHTML = summaryHTML;
}

// --- Fun√ß√£o de Envio (Backend) ---

function submitEvaluation() {
    // 1. Preparar dados
    evaluationData = [];
    const teamEmployees = employees[selectedTeam];
    const evaluatorTeam = selectedTeam;
    const timestamp = new Date().toISOString();
    // Substitui v√≠rgulas por ponto e v√≠rgula nas observa√ß√µes para evitar quebras no CSV (backend)
    const observations = document.getElementById('observations').value.replace(/,/g, ';'); 
    
    // Apenas prepara os dados dos funcion√°rios que t√™m pelo menos 1 item avaliado
    const validEmployees = teamEmployees.filter(employee => {
        return evaluations[employee] && criteria.some(criterion => evaluations[employee][criterion] > 0);
    });
    
    if (validEmployees.length === 0) {
        alert('Nenhum funcion√°rio foi avaliado. Por favor, volte e avalie pelo menos um crit√©rio para cada colega.');
        return;
    }
    
    validEmployees.forEach(employee => {
        let totalScore = 0;
        let criteriaCounted = 0;
        const row = {
            'Data_Avaliacao': timestamp,
            'Equipe_Avaliador': evaluatorTeam,
            'Funcionario_Avaliado': employee,
            'Equipe_Avaliado': selectedTeam
        };
        
        criteria.forEach(criterion => {
            const score = evaluations[employee][criterion] || 0;
            if (score > 0) {
                totalScore += score;
                criteriaCounted++;
            }
            // Usa replace para criar chaves consistentes com os cabe√ßalhos da planilha
            row[criterion.replace(/\s+/g, '_')] = score; 
        });
        
        row['Pontuacao_Total'] = totalScore;
        row['Criterios_Avaliados'] = criteriaCounted;
        // Calcula a m√©dia apenas com os crit√©rios avaliados
        row['Media'] = criteriaCounted > 0 ? (totalScore / criteriaCounted).toFixed(2) : '0.00'; 
        row['Observacoes'] = observations;
        
        evaluationData.push(row);
    });

    // 2. ENVIAR DADOS PARA O GOOGLE APPS SCRIPT
    fetch(WEB_APP_URL, {
        method: 'POST',
        mode: 'cors', 
        headers: {
            'Content-Type': 'text/plain;charset=utf-8', 
        },
        body: JSON.stringify(evaluationData) 
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('A resposta da rede n√£o foi OK: ' + response.statusText);
        }
        return response.json();
    })
    .then(result => {
        console.log('Sucesso:', result);
        // Avan√ßa para a tela de confirma√ß√£o ap√≥s o envio bem-sucedido
        currentStep = 5;
        showStep();
    })
    .catch(error => {
        console.error('Erro ao enviar a avalia√ß√£o:', error);
        alert('Ocorreu um erro ao enviar sua avalia√ß√£o. Por favor, tente novamente. Os dados foram salvos localmente.');
        // Se falhar, oferece a chance de baixar como backup
        // downloadCSV(); 
    });
}


// --- Fun√ß√µes de Utilit√°rios ---

function downloadCSV() {
    // ... (Manter a sua fun√ß√£o downloadCSV original para backup)
    if (evaluationData.length === 0) {
        alert('Nenhum dado para exportar!');
        return;
    }
    
    const headers = Object.keys(evaluationData[0]);
    let csvContent = headers.join(',') + '\n';
    
    evaluationData.forEach(row => {
        const values = headers.map(header => {
            let value = row[header] || '';
            if (typeof value === 'string' && value.includes(',')) {
                value = '"' + value.replace(/"/g, '""') + '"';
            }
            return value;
        });
        csvContent += values.join(',') + '\n';
    });
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `avaliacao_funcionarios_${selectedTeam}_${new Date().toISOString().slice(0,10)}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function resetForm() {
    currentStep = 1;
    selectedTeam = '';
    evaluations = {};
    evaluationData = [];
    currentEmployeeIndex = 0;
    document.getElementById('teamSelect').value = '';
    document.getElementById('observations').value = '';
    document.getElementById('evaluationContainer').innerHTML = ''; // Limpa os cards de avalia√ß√£o
    showStep();
}

// Inicializar
showStep();
</script>
</body>
</html>